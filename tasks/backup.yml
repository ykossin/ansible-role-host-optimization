---
# Резервное копирование конфигурационных файлов

- name: Создание директории для бэкапов
  file:
    path: /root/ansible-backups/host-optimization
    state: directory
    mode: '0755'
  tags:
    - optimization
    - backup

- name: Резервное копирование /etc/default/grub
  copy:
    src: /etc/default/grub
    dest: "/root/ansible-backups/host-optimization/grub-{{ ansible_date_time.epoch }}.bak"
    remote_src: true
    mode: '0644'
  when:
    - host_optimization_enabled
    - host_optimization_for_virtualization
  changed_when: false
  tags:
    - optimization
    - backup

- name: Резервное копирование /etc/fstab
  copy:
    src: /etc/fstab
    dest: "/root/ansible-backups/host-optimization/fstab-{{ ansible_date_time.epoch }}.bak"
    remote_src: true
    mode: '0644'
  when:
    - host_optimization_enabled
    - host_fstab_noatime
  changed_when: false
  tags:
    - optimization
    - backup

- name: Резервное копирование /etc/security/limits.conf
  copy:
    src: /etc/security/limits.conf
    dest: "/root/ansible-backups/host-optimization/limits-{{ ansible_date_time.epoch }}.bak"
    remote_src: true
    mode: '0644'
  when: host_optimization_enabled
  changed_when: false
  tags:
    - optimization
    - backup
